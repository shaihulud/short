# Short

## ТЗ

Цель -- написать простой сервис коротких ссылок.

Сервис коротких ссылок позволяет из длинных URL на оригинальный ресурс
сделать короткие URL, которые при переходе перенаправляют на оригинальный.
Аналог - bit.ly

В этом задании не нужно писать все возможные функции (авторизацию, браузерный
пользовательский интерфейс, итд), а сосредоточиться на самом главном. 

Функциональные требования:
- POST запрос на \<hostname>/urls с оригинальной ссылкой, генерирует новый короткий URL, 
  и возвращает его в формате \<hostname>/urls/\<short code>, где \<short code> это короткий
  уникальный "код" ссылки
- GET запрос на \<hostname>/urls/\<short code> перенаправляет пользователя на оригинальную
  ссылку
- GET запрос на \<hostname>/urls/\<short code>/stats возвращает количество переходов по
  ссылке за последние 24 часа
- PUT запрос на \<hostname>/urls/\<short code> с новой ссылкой обновляет существующую
  короткую ссылку
- DELETE запрос на \<hostname>/urls/\<short code> удаляет короткую ссылку

Нефункциональные требования:
- Желательно выложить код в git репозиторий (github, gitlab, bitbucket, или любой другой
  по выбору).
- Язык программирования лучше всего -- Python, но любой другой тоже подойдет, если на нем есть
  хорошие рабочие навыки и это сэкономит время.
- Лучше всего писать меньше кода, но качественно. Так, чтобы это демонстрировало реальные
  "боевые" навыки.

## Запуск проекта
docker-compose up

Проект стартует на порту 8000 в Docker образе с Redis и PostgreSQL.
Интерфейс для удобного доступа к API проекта после старта доступен по адресу http://127.0.0.1:8000/docs

Каждая ручка имеет описание и доступна без авторизации.

## Запуск тестов
docker-compose run app tests

Запускает чекеры кода: isort, black, pylint, mypy.
Далее обновляет структуру БД и запускает тесты pytest.

## Структура
В корне проекта short лежат следующие директории:
- app, содержащая код на Python сервиса коротких ссылок
- migrations, содержащая миграции для БД Postgres с необходимыми таблицами, индексами и системными файлами.
- tests, содержащая не столь большое количество тестов, как бы того хотелось :(
- системные файлы для старта проекта через докер, настройки линтеров и списки зависимостей. 

В директории app содержатся следующие директории и файлы проекта:
- server.py - стартовая точка, главный файл проекта. Содержит настройки логирования, управления исключениями и преобразования их в вид, который фронтэнд сможет легко распарсить и отобразить. А так же скрипты, которые раз в час очищают старые данные из таблиц с УРЛами и статистики. Поскольку по ТЗ я показываю статистику только за последние 24 часа, я решил не хранить её дольше. Естественно, при наличии места и отличного ТЗ это будет выглядеть иначе.
- logging.py - файл с настройками логирования
- exceptions.py - файл с настройками исключений, которые пользователь видеть не должен, как 500 ошибку на весь экран. При добавлении исключения в список, оно будет перехвачено, обработано и отдано на фронт в виде стандартного JSON.
- db.py - базовый класс для наследования SQLAlchemy моделей и их стандартизации
- utils.py - пара используемых в проекте небольших функций
- config.py - настройки приложения. Если в корень проекта положить файл .env, то определённые в нём настройки перезапишут таковые из конфига.
- директория api - содержит "пробы" - небольшие ручки, которые показывают текущее состояние сервиса, его работоспособность.
- apps/urls/models.py и apps/urls/schemas.py - содержит модели SQLAlchemy для БД, модели Pydantic для отображение и верификации пользовательского ввода
- и, наконец-то =), apps/urls/api/urls.py - список методов, которые по ТЗ я и должен был реализовать.
